# 国际化模块操作手册

## 概述

国际化模块为游戏宏系统提供了多语言支持功能，让用户可以使用不同的语言界面。它采用简单而高效的INI文件格式来存储语言包，支持UTF-8编码，确保各种语言字符的正确显示。该模块具备自动语言回退机制，即使缺少特定语言包也能正常运行。

## 主要功能

### 1. 多语言包管理
- **语言包加载**: 自动加载指定语言的语言包文件
- **语言列表**: 提供所有可用语言的列表
- **动态切换**: 支持运行时动态切换界面语言
- **自动回退**: 当指定语言不存在时自动回退到默认语言

### 2. 翻译系统
- **基础翻译**: 提供键值对的文本翻译功能
- **参数替换**: 支持在翻译文本中使用变量占位符
- **默认文本**: 未找到翻译时自动使用默认文本
- **缓存机制**: 翻译结果缓存以提高性能

### 3. 文件格式支持
- **INI格式**: 使用标准INI格式存储翻译文本
- **UTF-8编码**: 完全支持各种语言字符编码
- **元数据管理**: 支持语言包的元信息存储
- **分段组织**: 使用段来组织不同类型的翻译文本

## 语言包结构

### 文件位置
语言包文件保存在：`程序目录\Languages\[语言代码].ini`

### 文件格式
```ini
[meta]
Name=简体中文        ; 语言包显示名称
Version=1.0          ; 语言包版本
Author=用户          ; 语言包作者
Description=中文界面   ; 语言包描述

[strings]
; 界面文本
MainWindow=主窗口
Settings=设置
Start=启动
Stop=停止
Save=保存
Cancel=取消

; 功能描述
SkillConfig=技能配置
RuleConfig=规则配置
BuffConfig=BUFF配置

; 错误信息
Error_FileNotFound=文件未找到
Error_InvalidConfig=配置无效
Success_Saved=保存成功
```

### 支持的语言代码
```
zh-CN = 简体中文
en-US = English
zh-TW = 繁體中文
ja-JP = 日本語
ko-KR = 한국어
```

## 操作指南

### 1. 创建新语言包

#### 步骤1：创建语言文件
1. 在`Languages`目录下创建新的INI文件
2. 文件命名格式：`[语言代码].ini`
   - 例如：`en-US.ini`、`ja-JP.ini`

#### 步骤2：编辑语言包内容
```ini
[meta]
Name=English
Version=1.0
Author=Translator
Description=English Interface

[strings]
; Window Titles
MainWindow=Main Window
Settings=Settings
About=About

; Buttons
Start=Start
Stop=Stop
Save=Save
Cancel=Cancel
Load=Load
Export=Export

; Configuration
SkillConfig=Skill Configuration
RuleConfig=Rule Configuration
BuffConfig=Buff Configuration
RotationConfig=Rotation Configuration

; Messages
Error_FileNotFound=File not found
Error_InvalidConfig=Invalid configuration
Success_Saved=Saved successfully
StartingMacro=Starting macro...
StoppingMacro=Stopping macro...
```

#### 步骤3：保存文件
- 使用UTF-8编码保存文件
- 确保`[meta]`段包含`Name`字段
- 验证`[strings]`段包含所需翻译

### 2. 编辑现有语言包

#### 添加新翻译
在`[strings]`段中添加新的键值对：
```ini
[strings]
; 现有翻译...
NewFeature=新功能说明
HelpText=帮助信息
TooltipText=提示文字
```

#### 更新翻译内容
修改现有键的值：
```ini
[strings]
Start=开始运行    ; 从"启动"改为"开始运行"
Settings=配置     ; 从"设置"改为"配置"
```

#### 删除翻译
删除不需要的键值对或注释掉：
```ini
[strings]
; ObsoleteFeature=已过时的功能
UnusedButton=unused  ; 标记为unused而非删除
```

### 3. 语言包管理

#### 备份语言包
1. 复制`Languages`目录下的所有INI文件
2. 创建备份压缩包
3. 定期备份重要语言包

#### 分享语言包
1. 提供完整的INI文件
2. 包含元数据信息
3. 提供安装说明

#### 语言包验证
使用程序的语言包列表功能验证：
```ahk
packages := Lang_ListPackages()
for _, pkg in packages {
    MsgBox "语言代码: " pkg.Code "`n语言名称: " pkg.Name
}
```

### 4. 在代码中使用翻译

#### 基础翻译
```ahk
; 显示按钮文本
GuiControlSetText("Button1", T("Start", "启动"))

; 显示标题
GuiControlSetText("Static1", T("MainWindow", "主窗口"))

; 显示错误信息
Notify(T("Error_FileNotFound", "文件未找到"))
```

#### 带参数的翻译
```ahk
; 带替换变量的翻译
msg := TF("Success_Saved", Map("name", profileName), "保存成功：{name}")
Notify(msg)

; 多参数替换
status := TF("Macro_Status", Map("status", currentStatus, "count", skillCount), "宏状态：{status}，技能数：{count}")
```

#### 动态语言切换
```ahk
; 切换到英文
Lang_SetLanguage("en-US")

; 刷新界面文本
ReloadAllInterfaceTexts()

; 切换到中文
Lang_SetLanguage("zh-CN")
```

## 高级功能

### 1. 参数化翻译
支持复杂的文本格式化：
```ini
[strings]
WelcomeUser=欢迎 {user} 使用 {appName}
SkillUsed=技能 {skillIndex} 已使用 {count} 次
TimeRemaining=剩余时间 {minutes} 分 {seconds} 秒
```

在代码中使用：
```ahk
; 欢迎消息
welcome := TF("WelcomeUser", Map("user", playerName, "appName", "GW2宏工具"), "欢迎 {user} 使用 {appName}")

; 技能统计
skillInfo := TF("SkillUsed", Map("skillIndex", idx, "count", useCount))

; 时间显示
timeInfo := TF("TimeRemaining", Map("minutes", remainingMin, "seconds", remainingSec))
```

### 2. 复数形式支持
```ini
[strings]
ItemCount_Single={count} 个物品
ItemCount_Multiple={count} 个物品

; 或者使用更灵活的格式
ItemCount={count} 个物品
```

### 3. 条件翻译
```ini
[strings]
Status_Online=在线
Status_Offline=离线
Status_Unknown=状态未知
```

### 4. 格式化文本
```ini
[strings]
FormattedText=这是<b>粗体文字</b>和<i>斜体文字</i>
NewLineText=第一行`r`n第二行`r`n第三行
TabbedText=项目1`t项目2`t项目3
```

## 最佳实践

### 1. 翻译质量
```
保持一致性：
- 使用统一的术语翻译
- 保持界面风格一致
- 考虑目标语言的文化习惯

简化表达：
- 使用简短明了的翻译
- 避免过于复杂的句式
- 确保在界面中显示完整
```

### 2. 键命名规范
```
使用有意义的键名：
SkillConfig          ✓ 好的键名
Skill_Config         ✓ 好的键名
sc                  ✗ 避免简写

按功能分组：
UI_Button_Start      ✓ 界面按钮
Error_Message_NotFound  ✓ 错误信息
Config_Skill_Save   ✓ 配置相关
```

### 3. 字符编码
```
UTF-8编码：
- 确保文件使用UTF-8编码保存
- 支持中文、日文、韩文等字符
- 正确处理特殊符号和表情

避免编码问题：
- 不要使用ANSI编码
- 避免混合字符集
- 确保字体支持目标字符
```

### 4. 版本管理
```
版本标记：
- 在[meta]段记录版本信息
- 提供更新日志
- 注明兼容性说明

维护更新：
- 定期更新语言包
- 同步新的翻译内容
- 修复已知问题
```

## 故障排除

### 语言包不加载
**症状**: 程序显示英文而非预期语言
**解决方法**:
1. 检查语言包文件是否存在
2. 验证文件编码是否为UTF-8
3. 确认INI格式正确
4. 检查语言代码是否正确

### 翻译文本缺失
**症状**: 界面显示键名而非翻译文本
**解决方法**:
1. 检查键名是否完全匹配
2. 验证[字符串]段存在
3. 确认值不为空
4. 检查默认值设置

### 字符显示异常
**症状**: 翻译文本显示乱码或方框
**解决方法**:
1. 检查文件编码是否为UTF-8
2. 确认系统字体支持目标字符
3. 验证文本格式正确
4. 重新保存文件

### 语言切换无效
**症状**: 切换语言后界面没有变化
**解决方法**:
1. 刷新界面显示文本
2. 重新加载语言包
3. 检查语言包文件路径
4. 重启程序

### 性能问题
**症状**: 语言切换或文本显示缓慢
**解决方法**:
1. 减少不必要的翻译调用
2. 优化语言包文件大小
3. 使用缓存机制
4. 避免频繁的翻译查询

## 与其他模块的协作

### 与UI模块协作
- 为界面元素提供多语言文本
- 支持动态界面文本更新
- 处理字体和显示适配

### 与配置模块协作
- 支持配置界面的多语言显示
- 处理配置项的翻译名称
- 保存用户的语言偏好设置

### 与日志模块协作
- 支持日志信息的多语言输出
- 提供错误信息的本地化描述
- 增强用户体验的本地化反馈

## 注意事项

1. **编码要求**: 语言包文件必须使用UTF-8编码保存
2. **格式规范**: 严格遵循INI文件格式，避免语法错误
3. **键名唯一**: 确保每个键名在语言包中唯一
4. **版本兼容**: 注意不同版本程序对语言包格式的支持
5. **文化适配**: 翻译要考虑目标语言的文化习惯

通过合理使用国际化模块，程序可以支持多种语言界面，满足不同地区用户的需求，提升程序的可用性和用户体验。