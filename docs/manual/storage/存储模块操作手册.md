# 存储模块操作手册

## 概述

存储模块负责管理整个游戏宏配置的数据存储和读取，是配置文件与程序之间的桥梁。它将用户的配置设置持久化保存，并在程序启动时加载这些配置，确保用户的个性化设置不会丢失。

## 主要功能

### 1. 配置文件管理
- **配置列表获取**: 自动扫描并列出所有可用的配置文件
- **配置加载**: 将INI配置文件中的数据读取到程序内存中
- **配置保存**: 将程序内存中的配置数据写入INI文件

### 2. 数据类型支持
- **基础设置**: 热键、轮询间隔、冷却时间等常规参数
- **技能配置**: 技能名称、按键、位置坐标、颜色判断、施放时间等
- **坐标点配置**: 辅助坐标点、颜色检测参数等
- **BUFF管理**: 持续时间、刷新策略、技能关联等
- **规则系统**: 条件判断、动作执行、优先级设置等
- **线程管理**: 多线程配置和线程名称设置
- **旋转系统**: Track定义、Gate条件、Opener步骤等

### 3. 配置导出功能
- **完整打包**: 将当前配置及必要文件打包为完整的使用包
- **独立运行**: 导出的包可以独立运行，无需额外配置

## 配置结构说明

### 配置文件位置
配置文件默认保存在：`程序目录\Profiles\[配置名称].ini`

### 主要配置段

#### [General] - 基础设置
```ini
[General]
StartHotkey=F1              ; 启动热键
PollIntervalMs=16          ; 轮询间隔(毫秒)
SendCooldownMs=80          ; 发送冷却(毫秒)
PickHoverEnabled=1         ; 拾取悬停启用
SkillCount=10              ; 技能数量
PointCount=5               ; 坐标点数量
BuffCount=3                ; BUFF数量
RuleCount=5                ; 规则数量
ThreadCount=2              ; 线程数量
```

#### [Skill1] - [SkillN] - 技能配置
```ini
[Skill1]
Name=普通攻击              ; 技能名称
Key=1                      ; 技能按键
X=1234                     ; 技能图标X坐标
Y=567                      ; 技能图标Y坐标
Color=0xFF5733            ; 技能就绪颜色
Tol=10                     ; 颜色容差
CastMs=500                 ; 施法时间
```

#### [Point1] - [PointN] - 坐标点配置
```ini
[Point1]
Name=血量检测点            ; 坐标点名称
X=100                      ; X坐标
Y=200                      ; Y坐标
Color=0xFF0000            ; 目标颜色
Tol=15                     ; 颜色容差
```

#### [Buff1] - [BuffN] - BUFF配置
```ini
[Buff1]
Name=力量增益              ; BUFF名称
Enabled=1                  ; 启用状态
DurationMs=30000          ; 持续时间(毫秒)
RefreshBeforeMs=5000      ; 提前刷新时间(毫秒)
CheckReady=1              ; 检查技能就绪
ThreadId=1                ; 所属线程
SkillCount=2              ; 相关技能数量
Buff1_Skill1=1            ; 技能索引1
Buff1_Skill2=3            ; 技能索引2
```

#### [Rule1] - [RuleN] - 规则配置
```ini
[Rule1]
Name=血量过低治疗          ; 规则名称
Enabled=1                  ; 启用状态
Logic=AND                 ; 条件逻辑(AND/OR)
CooldownMs=2000           ; 冷却时间(毫秒)
Priority=1                ; 优先级
ActionGapMs=60            ; 动作间隔(毫秒)
CondCount=2               ; 条件数量
ActCount=1                ; 动作数量
ThreadId=1                ; 所属线程
```

## 操作步骤

### 1. 创建新配置
1. 启动程序后，在配置管理界面选择"新建配置"
2. 输入配置名称（仅支持字母、数字、下划线）
3. 程序会自动创建对应的INI文件

### 2. 编辑配置
1. 选择要编辑的配置文件
2. 在对应的设置页面修改参数
3. 点击"保存"按钮将更改写入文件

### 3. 导入配置
1. 将INI文件放入`Profiles`目录
2. 重启程序或在配置列表中刷新
3. 选择导入的配置文件

### 4. 导出配置
1. 在配置管理界面选择要导出的配置
2. 点击"导出配置"按钮
3. 选择导出位置
4. 程序会自动创建完整的使用包

### 5. 备份配置
1. 手动复制`Profiles`目录下的所有INI文件
2. 或者使用导出功能创建完整备份
3. 建议定期备份重要配置

## 配置优化建议

### 性能优化
- 适当调整`PollIntervalMs`值，平衡响应速度和资源消耗
- 减少不必要的颜色检测点
- 合理设置冷却时间避免过度执行

### 稳定性优化
- 使用合适的颜色容差值，避免误判
- 为关键技能设置合适的施放时间
- 合理设置线程隔离，避免冲突

### 功能优化
- 按优先级排序规则，确保重要规则优先执行
- 为BUFF设置合理的提前刷新时间
- 利用Track和Gate实现复杂的旋转逻辑

## 故障排除

### 配置文件损坏
**症状**: 程序无法启动或读取配置报错
**解决方法**:
1. 检查INI文件语法是否正确
2. 使用程序内置的配置文件修复功能
3. 从备份恢复配置文件

### 配置不生效
**症状**: 修改配置后程序行为没有变化
**解决方法**:
1. 确认保存操作成功完成
2. 重启程序重新加载配置
3. 检查配置参数是否在有效范围内

### 导出失败
**症状**: 导出功能无法正常工作
**解决方法**:
1. 检查目标目录是否有写入权限
2. 确保磁盘空间充足
3. 关闭正在使用配置的程序进程

### 性能问题
**症状**: 程序运行缓慢或卡顿
**解决方法**:
1. 检查轮询间隔是否设置过小
2. 减少同时运行的颜色检测点数量
3. 优化规则和BUFF的检查频率

## 高级功能

### 自定义配置段
经验用户可以在INI文件中添加自定义配置段，程序会自动忽略未知字段。

### 配置文件版本管理
程序会在配置文件中保存版本信息，确保配置兼容性和升级安全性。

### 配置文件加密
对于敏感配置，用户可以启用配置文件加密功能，保护个人设置安全。

### 批量配置管理
支持批量导入、导出、复制配置文件，方便管理多个配置方案。

## 注意事项

1. **备份重要**: 配置文件包含所有个人设置，请务必定期备份
2. **路径要求**: 确保程序对配置目录有完整的读写权限
3. **格式规范**: 手动编辑INI文件时务必遵循标准格式
4. **版本兼容**: 不同版本的程序可能对配置文件格式有不同要求
5. **敏感信息**: 避免在配置文件中存储敏感信息

通过熟练掌握存储模块的功能和操作，用户可以更好地管理和维护自己的游戏宏配置，实现个性化和高效的游戏体验。