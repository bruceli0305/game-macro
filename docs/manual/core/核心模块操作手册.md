# 核心模块操作手册

## 概述

核心模块是游戏宏程序的"大脑"，负责管理全局配置、配置文件的创建和管理、以及程序的整体运行状态。理解核心模块能帮助您更好地掌控您的自动化宏。

## 主要功能

### 1. 配置管理

#### 配置文件的位置
您的所有配置都保存在以下目录中：
- **配置文件目录**: `游戏宏程序文件夹/Profiles/`
- **导出目录**: `游戏宏程序文件夹/Exports/`
- **程序配置**: `游戏宏程序文件夹/Config/AppConfig.ini`

#### 默认配置文件
系统会自动创建名为 "Default.ini" 的默认配置文件。

### 2. 核心配置项说明

#### 基础运行设置

**1. 开始/停止热键**
- **作用**: 控制宏的开始和停止
- **默认值**: F9
- **设置方法**: 在配置文件中修改 "StartHotkey" 的值
- **常用设置**: F9, F10, F11, 鼠标按键等

**2. 轮询间隔**
- **作用**: 宏检查游戏状态的时间间隔
- **默认值**: 25毫秒
- **建议设置**: 
  - 快速响应: 15-25毫秒
  - 平衡性能: 25-50毫秒
  - 节能模式: 50-100毫秒
- **注意事项**: 数值越小越敏感，但消耗CPU更多

**3. 发送冷却时间**
- **作用**: 两次按键之间的最小间隔
- **默认值**: 250毫秒
- **建议设置**: 200-500毫秒（根据游戏要求调整）

#### 智能取色设置

**4. 取色避让功能**
- **作用**: 避免鼠标停留在技能图标上造成干扰
- **默认值**: 开启
- **设置选项**: 
  - 1 = 开启避让
  - 0 = 关闭避让

**5. 避让偏移距离**
- **作用**: 鼠标移动避开技能图标的距离
- **默认值**: -60像素（向上移动）
- **正数**: 向下移动
- **负数**: 向上移动

**6. 避让等待时间**
- **作用**: 避让后等待多久再点击
- **默认值**: 120毫秒

**7. 取色确认键**
- **作用**: 用于确认颜色采集的按键
- **默认值**: LButton（左键）
- **常用设置**: LButton, Space, Enter

### 3. 技能配置

#### 技能列表设置
每个技能包含以下参数：
- **Name**: 技能名称（便于识别）
- **Key**: 对应的按键（如 "Q", "W", "R"）
- **X, Y**: 技能图标在屏幕上的坐标
- **Color**: 技能图标显示的颜色（十六进制格式，如 0xFF5733）
- **Tol**: 颜色容差（允许的颜色偏差范围）

#### 技能配置步骤

**第一步：准备工作**
1. 进入游戏，确保界面布局固定
2. 打开技能栏或快捷栏

**第二步：采集技能坐标**
1. 运行宏程序
2. 使用"采集模式"或手动记录每个技能的X、Y坐标
3. 建议使用取色工具确认坐标位置

**第三步：设置技能颜色**
1. 在技能图标上使用取色工具
2. 记录颜色值（如 0xFF5733）
3. 设置合适的颜色容差（一般10-30）

### 4. 线程管理

#### 线程概念
线程相当于独立的"工作队列"，可以同时处理不同的任务。

**默认线程**
- 系统自动创建"默认线程"
- 可以创建多个线程来分别处理不同类型的操作

**建议使用场景**
- 线程1: 主要技能循环
- 线程2: Buff维持
- 线程3: 特殊技能处理

### 5. 兜底技能设置

#### 什么是兜底技能？
当主要技能都无法使用时，系统会使用兜底技能作为"备用方案"。

#### 配置参数
- **Enabled**: 是否启用兜底技能（0=关闭，1=开启）
- **SkillIndex**: 选择兜底技能（0=未选择）
- **CheckReady**: 是否检测技能就绪状态
- **CooldownMs**: 兜底技能冷却时间
- **PreDelayMs**: 使用前的延时

### 6. 旋转系统

#### 旋转功能
自动在多个技能或配置之间循环切换，提高效率。

#### 主要设置
- **Enabled**: 启用旋转系统
- **DefaultTrackId**: 默认使用的轨道
- **SwapKey**: 切换轨道时发送的按键

#### 智能保护
- **BusyWindowMs**: 忙碌状态窗口时间
- **ColorTolBlack**: 黑色识别容差
- **RespectCastLock**: 遵循施法锁定状态

## 操作步骤

### 创建新配置文件

1. **启动程序**
   ```
   双击运行主程序
   ```

2. **选择配置**
   ```
   在界面中选择"新建配置"
   或直接修改默认配置
   ```

3. **设置基础参数**
   ```
   配置开始热键
   调整轮询间隔
   设置发送延迟
   ```

4. **添加技能**
   ```
   点击"添加技能"
   输入技能名称
   设置按键
   采集坐标和颜色
   ```

5. **测试配置**
   ```
   点击"开始"测试
   观察是否正常工作
   根据需要调整参数
   ```

6. **保存配置**
   ```
   点击"保存"
   输入配置名称
   确认保存到Profiles目录
   ```

### 常用配置建议

#### 快速攻击类游戏
```
轮询间隔: 15-20ms
发送延迟: 200ms
取色避让: 开启
```

#### 策略类游戏
```
轮询间隔: 50-100ms
发送延迟: 500ms
取色避让: 关闭
```

#### RPG游戏
```
轮照间隔: 25-50ms
发送延迟: 300ms
多线程: 开启
```

## 常见问题

### Q1: 宏没有反应？
**A1**: 检查以下几点：
- 确认热键设置正确
- 检查游戏是否有管理员权限
- 确认配置已保存并加载
- 查看日志文件是否有错误信息

### Q2: 技能识别不准确？
**A2**: 尝试以下解决方法：
- 调整颜色容差值
- 重新采集技能坐标
- 确保游戏界面布局一致
- 检查光线条件是否影响颜色识别

### Q3: 程序占用CPU过高？
**A3**: 优化方法：
- 增加轮照间隔
- 减少同时监控的技能数量
- 关闭不必要的取色避让功能

### Q4: 配置文件丢失？
**A4**: 恢复方法：
- 检查Profiles目录是否存在
- 查看是否有备份文件
- 使用导出功能定期备份配置

## 进阶使用技巧

### 1. 多配置文件管理
- 为不同游戏或角色创建独立配置
- 使用有意义的文件名
- 定期导出备份

### 2. 性能优化
- 根据硬件性能调整轮照频率
- 合理分配线程负载
- 定期清理不需要的规则

### 3. 安全使用
- 始终遵守游戏服务条款
- 不要在PVP环境中使用
- 保持配置适度，避免过度自动化

## 获取帮助

如果遇到问题：
1. 查看日志文件：`游戏宏程序文件夹/Logs/`
2. 检查配置文件格式是否正确
3. 尝试恢复默认设置重新配置

---

**注意**: 本手册针对普通用户编写，如需技术细节请参考开发者文档。