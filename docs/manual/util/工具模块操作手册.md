# 工具模块操作手册

## 概述

工具模块提供了一系列实用的辅助函数，用于改善用户体验和界面交互。它包含了通知显示、用户确认对话框、主窗口激活等常用功能，是整个程序用户界面的重要支撑模块。

## 主要功能

### 1. 通知系统 (Notify)
- **自动消失提示**: 显示临时消息提示框，自动在指定时间后消失
- **友好用户反馈**: 为操作结果提供即时反馈信息
- **非阻塞显示**: 不影响程序正常运行，用户无需手动关闭

### 2. 确认对话框 (Confirm)
- **用户确认机制**: 在执行重要操作前获取用户确认
- **Yes/No选择**: 提供简洁的二选一确认界面
- **安全防护**: 防止误操作，保护重要数据

### 3. 窗口管理 (UI_ActivateMain)
- **主窗口激活**: 将程序主窗口置于前台显示
- **焦点获取**: 确保用户操作焦点在正确窗口
- **界面友好**: 提供更好的用户交互体验

## 功能详解

### 通知系统 (Notify)

#### 基础用法
```ahk
; 显示默认提示（1.2秒后自动消失）
Notify("操作已完成")

; 显示自定义时间的提示
Notify("保存配置成功", 3000)
Notify("错误：配置无效", 5000)
```

#### 使用场景
- **配置保存**: "配置文件已保存"
- **操作成功**: "导出完成，请查看目标目录"
- **错误提示**: "无法读取配置文件，请检查文件格式"
- **状态更新**: "宏已启动，按F1停止"
- **进度提示**: "正在处理，请稍候..."

#### 自定义建议
- **简短明了**: 通知消息应简洁明了，一目了然
- **时间合理**: 根据消息重要性调整显示时间
  - 成功消息：1000-2000毫秒
  - 警告消息：2000-3000毫秒
  - 错误消息：3000-5000毫秒

### 确认对话框 (Confirm)

#### 基础用法
```ahk
; 基础确认对话框
if Confirm("确定要删除当前配置吗？此操作无法撤销。") {
    ; 用户选择"是"，执行删除操作
    DeleteConfig()
} else {
    ; 用户选择"否"，取消操作
    return
}

; 配合危险操作使用
if Confirm("即将清空所有日志文件，确定继续吗？") {
    ClearLogFiles()
    Notify("日志文件已清空")
}
```

#### 使用场景
- **数据删除**: "确定要删除此配置文件吗？"
- **危险操作**: "此操作将重置所有设置，确定继续吗？"
- **批量处理**: "将对10个配置文件执行批量导出，确认开始吗？"
- **覆盖确认**: "目标文件已存在，确定覆盖吗？"
- **退出确认**: "宏正在运行，确定要退出吗？"

#### 安全建议
- **重要操作**: 涉及数据修改的操作都应使用确认对话框
- **明确提示**: 在确认信息中明确说明操作后果
- **撤销说明**: 如有撤销方式，应在确认信息中说明

### 窗口管理 (UI_ActivateMain)

#### 基础用法
```ahk
; 在重要操作后激活主窗口
SaveConfig()
UI_ActivateMain()

; 在长时间操作后提醒用户
LongRunningOperation()
UI_ActivateMain()
Notify("操作完成，请查看结果")
```

#### 使用场景
- **配置修改后**: 用户修改设置后，主窗口回到前景
- **后台操作**: 后台任务完成后，主窗口重新激活
- **用户交互**: 需要用户输入时确保焦点在正确位置
- **错误恢复**: 出现错误后恢复到正常界面状态

## 操作指南

### 1. 通知消息的最佳实践
```
推荐格式：
- "操作+结果+建议"
- "配置已保存，请重启程序生效"
- "导出失败，请检查目标目录权限"
- "发现新版本，是否现在更新？"

避免格式：
- 过于技术化的描述
- 含糊不清的提示
- 过长或过短的消息
```

### 2. 确认对话框的设计原则
```
问题设计：
- 用疑问句式："确定要...吗？"
- 说明后果："此操作将..."
- 及时撤销："可以随时恢复"

选项明确：
- 使用"是/否"而非"确认/取消"
- 默认选择安全选项
- 考虑设置"不再提醒"选项
```

### 3. 窗口激活的时机
```
推荐激活时机：
- 用户主动操作后
- 后台任务完成后
- 发生错误需要用户注意时
- 程序状态发生重要变化时

避免激活场景：
- 频繁的短操作进行中
- 用户正在进行其他操作
- 程序在后台正常运行
```

## 故障排除

### 通知不显示
**症状**: 程序执行后没有看到通知消息
**解决方法**:
1. 检查消息内容是否为有效字符串
2. 确认显示时间设置合理（太短可能瞬间消失）
3. 检查系统通知设置是否有冲突

### 确认对话框不出现
**症状**: 程序跳过了确认步骤直接执行操作
**解决方法**:
1. 确认Confirm函数返回值被正确检查
2. 检查对话框是否被系统阻止或阻止显示
3. 验证消息内容格式正确

### 窗口激活失败
**症状**: 主窗口没有成功激活到前台
**解决方法**:
1. 检查主窗口句柄是否有效
2. 确认程序有足够的系统权限
3. 验证窗口状态是否正常（非最小化或隐藏）

## 高级技巧

### 自定义通知样式
通过修改Notify函数，可以实现：
- 不同类型的通知样式（成功、警告、错误）
- 位置自定义（屏幕角落、窗口附近）
- 动画效果（淡入淡出、移动）

### 智能确认逻辑
增强确认对话框功能：
- 记住用户选择（避免重复确认）
- 根据操作类型调整确认级别
- 提供详细的操作预览

### 窗口管理优化
改进窗口激活策略：
- 检测用户当前活动窗口
- 避免打断用户正在进行的其他操作
- 优雅的窗口切换动画

## 与其他模块的协作

### 与UI模块协作
- 为UI操作提供即时反馈
- 在界面切换时提供状态提示
- 支持用户交互的必要确认

### 与存储模块协作
- 在配置保存/加载时提供状态反馈
- 对重要的数据操作提供确认
- 在配置文件异常时给出友好提示

### 与运行时模块协作
- 在宏启停时提供状态通知
- 对长时间运行的操作提供进度提示
- 在异常情况下引导用户处理

## 注意事项

1. **适度使用**: 不要过度使用通知，避免打扰用户
2. **及时清理**: 确保临时显示的元素被正确清理
3. **用户友好**: 通知内容要通俗易懂，避免技术术语
4. **权限考虑**: 窗口激活功能需要适当的系统权限
5. **兼容性**: 在不同版本的系统上测试显示效果

通过合理使用工具模块的功能，可以显著提升程序的用户体验和操作便利性，让自动化宏更加人性化和易用。